# æ˜Ÿæ²³ï¼ˆXingheï¼‰AI è§†é¢‘åˆ›ä½œè½¯ä»¶ - å®Œæ•´æŠ€æœ¯æ–‡æ¡£

> **æ–‡æ¡£ç‰ˆæœ¬**: 3.0  
> **æ›´æ–°æ—¥æœŸ**: 2026-01-19  
> **ç›®æ ‡è¯»è€…**: AI å¤§è¯­è¨€æ¨¡å‹ã€å¼€å‘è€…  
> **ç”¨é€”**: å®Œæ•´ç†è§£è½¯ä»¶æ¶æ„ã€æ‰‹åŠ¨æ¨¡å¼åˆ›ä½œæµç¨‹ã€æ•°æ®å…³è”æ–¹å¼

---

## ğŸ“š æ–‡æ¡£å¯¼èˆª

### æ ¸å¿ƒæ¦‚å¿µ
1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [åŒæ¨¡å¼æ¶æ„](#2-åŒæ¨¡å¼æ¶æ„)
3. [æ‰‹åŠ¨æ¨¡å¼è¯¦è§£](#3-æ‰‹åŠ¨æ¨¡å¼è¯¦è§£-é‡ç‚¹)

### æŠ€æœ¯æ¶æ„
4. [æ•°æ®æ¨¡å‹å’Œå…³è”](#4-æ•°æ®æ¨¡å‹å’Œå…³è”)
5. [ç•Œé¢æ¶æ„](#5-ç•Œé¢æ¶æ„)
6. [API æ¶æ„](#6-api-æ¶æ„)
7. [æ•°æ®æµ](#7-æ•°æ®æµ)

### å¼€å‘æŒ‡å—
8. [çŠ¶æ€ç®¡ç†](#8-çŠ¶æ€ç®¡ç†)
9. [æ•°æ®æŒä¹…åŒ–](#9-æ•°æ®æŒä¹…åŒ–)
10. [ä»£ç ç»“æ„](#10-ä»£ç ç»“æ„)
11. [ä¿®æ”¹æŒ‡å—](#11-ä¿®æ”¹æŒ‡å—)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®å®šä½

**æ˜Ÿæ²³ï¼ˆXingheï¼‰** æ˜¯ä¸€æ¬¾ **Flutter è·¨å¹³å° AI è§†é¢‘åˆ›ä½œå·¥å…·**ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯ï¼š

```
ç”¨æˆ·è¾“å…¥åˆ›æ„ â†’ AI è¾…åŠ©ç”Ÿæˆ â†’ å®Œæ•´è§†é¢‘è¾“å‡º
```

### 1.2 æ ¸å¿ƒç‰¹æ€§

- âœ… **åŒæ¨¡å¼å·¥ä½œæµ**ï¼šè‡ªåŠ¨æ¨¡å¼ï¼ˆå…¨è‡ªåŠ¨ï¼‰+ æ‰‹åŠ¨æ¨¡å¼ï¼ˆæ¨¡å—åŒ–ï¼‰
- âœ… **æ··åˆ API æ¶æ„**ï¼šå¯ä¸º LLM/å›¾ç‰‡/è§†é¢‘åˆ†åˆ«é…ç½®ä¾›åº”å•†
- âœ… **å®Œæ•´åˆ›ä½œæµç¨‹**ï¼šæ•…äº‹ â†’ å‰§æœ¬ â†’ åˆ†é•œ â†’ è§’è‰² â†’ åœºæ™¯ â†’ ç‰©å“ â†’ è§†é¢‘
- âœ… **æ•°æ®éš”ç¦»**ï¼šä¸¤ç§æ¨¡å¼æ•°æ®å®Œå…¨ç‹¬ç«‹
- âœ… **å“åº”å¼UI**ï¼šé€‚é…æ¡Œé¢ã€å¹³æ¿ã€ç§»åŠ¨ç«¯

### 1.3 æŠ€æœ¯æ ˆæ¦‚è§ˆ

```yaml
æ¡†æ¶: Flutter 3.10.4+
è¯­è¨€: Dart 3.10.4+
çŠ¶æ€ç®¡ç†: ChangeNotifier + StatefulWidget
æ•°æ®å­˜å‚¨: Hive + SharedPreferences + Supabase
è§†é¢‘å¤„ç†: FFmpeg
ç½‘ç»œ: http + dio
å¹¶å‘: pool + synchronized
```

---

## 2. åŒæ¨¡å¼æ¶æ„

### 2.1 æ¶æ„å¯¹æ¯”

| ç‰¹æ€§ | è‡ªåŠ¨æ¨¡å¼ | æ‰‹åŠ¨æ¨¡å¼ |
|------|---------|---------|
| **å·¥ä½œæµ** | çº¿æ€§ã€è‡ªåŠ¨åŒ– | æ¨¡å—åŒ–ã€æ‰‹åŠ¨æ§åˆ¶ |
| **é€‚ç”¨åœºæ™¯** | å¿«é€Ÿç”Ÿæˆå®Œæ•´è§†é¢‘ | ç²¾ç»†åŒ–åˆ›ä½œã€åˆ†æ­¥æ“ä½œ |
| **æ•°æ®å­˜å‚¨** | Hive Box | SharedPreferences |
| **çŠ¶æ€ç®¡ç†** | å•ä¾‹ AutoModeProvider | å„é¢æ¿ç‹¬ç«‹ State |
| **é¡¹ç›®æ¦‚å¿µ** | æœ‰ï¼ˆå¤šé¡¹ç›®ç®¡ç†ï¼‰ | æ— ï¼ˆå•ä¸€å·¥ä½œåŒºï¼‰ |

### 2.2 æ¨¡å¼åˆ‡æ¢

```
åº”ç”¨å…¥å£ï¼ˆHomePageï¼‰
    â”œâ”€ åˆ›ä½œç©ºé—´ï¼ˆé¡¹ç›®åˆ—è¡¨ï¼‰
    â”‚   â”œâ”€ è‡ªåŠ¨æ¨¡å¼é¡¹ç›®
    â”‚   â””â”€ æ‰‹åŠ¨æ¨¡å¼é¡¹ç›®
    â”œâ”€ è‡ªåŠ¨æ¨¡å¼å…¥å£ â†’ AutoModeScreen
    â””â”€ æ‰‹åŠ¨æ¨¡å¼å…¥å£ â†’ WorkspaceShell
```

ä¸¤ç§æ¨¡å¼**å®Œå…¨ç‹¬ç«‹**ï¼Œæ•°æ®ä¸äº’é€šã€‚

---

## 3. æ‰‹åŠ¨æ¨¡å¼è¯¦è§£ï¼ˆé‡ç‚¹ï¼‰

### 3.1 æ ¸å¿ƒæ¦‚å¿µ

æ‰‹åŠ¨æ¨¡å¼æ˜¯ä¸€ä¸ª**æ¨¡å—åŒ–çš„åˆ›ä½œå·¥ä½œåŒº**ï¼Œç‰¹ç‚¹ï¼š

- âŒ **æ²¡æœ‰é¡¹ç›®æ¦‚å¿µ**ï¼šåªæœ‰ä¸€ä¸ªå…¨å±€å·¥ä½œåŒº
- âœ… **6 ä¸ªç‹¬ç«‹é¢æ¿**ï¼šæ•…äº‹ã€å‰§æœ¬ã€åˆ†é•œã€è§’è‰²ã€åœºæ™¯ã€ç‰©å“
- âœ… **é¢æ¿ç‹¬ç«‹è¿ä½œ**ï¼šæ¯ä¸ªé¢æ¿æœ‰è‡ªå·±çš„æ•°æ®å’ŒçŠ¶æ€
- âœ… **æ•°æ®å¯äº’å¯¼**ï¼šé¢æ¿ä¹‹é—´å¯ä»¥å¤åˆ¶ç²˜è´´å†…å®¹

### 3.2 å·¥ä½œæµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ‰‹åŠ¨æ¨¡å¼å·¥ä½œæµç¨‹                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è¿›å…¥ WorkspaceShellï¼ˆæ‰‹åŠ¨æ¨¡å¼ä¸»ç•Œé¢ï¼‰                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é€šè¿‡å¯¼èˆªæ é€‰æ‹©åŠŸèƒ½é¢æ¿                                   â”‚
â”‚                                                         â”‚
â”‚  â”œâ”€ ğŸ“– æ•…äº‹ç”Ÿæˆ (StoryGenerationPanel)                  â”‚
â”‚  â”œâ”€ ğŸ“ å‰§æœ¬ç”Ÿæˆ (ScriptGenerationPanel)                 â”‚
â”‚  â”œâ”€ ğŸ¬ åˆ†é•œç”Ÿæˆ (StoryboardGenerationPanel)             â”‚
â”‚  â”œâ”€ ğŸ‘¤ è§’è‰²ç”Ÿæˆ (CharacterGenerationPanel)              â”‚
â”‚  â”œâ”€ ğŸï¸ åœºæ™¯ç”Ÿæˆ (SceneGenerationPanel)                 â”‚
â”‚  â””â”€ ğŸ¨ ç‰©å“ç”Ÿæˆ (PropGenerationPanel)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åœ¨æ¯ä¸ªé¢æ¿ä¸­ç‹¬ç«‹æ“ä½œ                                     â”‚
â”‚                                                         â”‚
â”‚  1. è¾“å…¥æç¤ºè¯                                           â”‚
â”‚  2. é€‰æ‹©æç¤ºè¯æ¨¡æ¿ï¼ˆå¯é€‰ï¼‰                                â”‚
â”‚  3. ç‚¹å‡»ç”ŸæˆæŒ‰é’® â†’ è°ƒç”¨ AI API                           â”‚
â”‚  4. æŸ¥çœ‹ç”Ÿæˆç»“æœ                                         â”‚
â”‚  5. ç¼–è¾‘ã€ä¿å­˜ã€åˆ é™¤                                     â”‚
â”‚  6. åˆ‡æ¢åˆ°å…¶ä»–é¢æ¿ï¼ˆæ•°æ®è‡ªåŠ¨ä¿å­˜åˆ° SharedPreferencesï¼‰    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¢æ¿ä¹‹é—´çš„æ•°æ®å…³è”ï¼ˆæ‰‹åŠ¨å¤åˆ¶ç²˜è´´ï¼‰                        â”‚
â”‚                                                         â”‚
â”‚  æ•…äº‹ç”Ÿæˆ â”€å¤åˆ¶â†’ å‰§æœ¬ç”Ÿæˆè¾“å…¥æ¡†                           â”‚
â”‚  å‰§æœ¬ç”Ÿæˆ â”€å¤åˆ¶â†’ åˆ†é•œç”Ÿæˆè¾“å…¥æ¡†                           â”‚
â”‚  åˆ†é•œç”Ÿæˆ â”€æå–â†’ è§’è‰²ç”Ÿæˆï¼ˆæ ¹æ®å‰§æœ¬ç”ŸæˆæŒ‰é’®ï¼‰              â”‚
â”‚  è§’è‰²ç”Ÿæˆçš„å›¾ç‰‡ â†’ å¯ç”¨äºè§†é¢‘ç©ºé—´                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 å…­å¤§åŠŸèƒ½é¢æ¿è¯¦è§£

#### 3.3.1 ğŸ“– æ•…äº‹ç”Ÿæˆé¢æ¿ (StoryGenerationPanel)

**åŠŸèƒ½**ï¼šæ ¹æ®åˆ›æ„ç”Ÿæˆå®Œæ•´æ•…äº‹

**ç•Œé¢å¸ƒå±€**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¡¶éƒ¨ï¼šæ ‡é¢˜ "ğŸ“– æ•…äº‹ç”Ÿæˆ - AI å¸®ä½ å®Œå–„å‰§æœ¬ç»†èŠ‚"         â”‚
â”‚ å³ä¸Šè§’ï¼šæç¤ºè¯æ¨¡æ¿é€‰æ‹©å™¨ + ä¿å­˜æŒ‰é’®                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  å·¦ä¾§ï¼ˆè¾“å…¥åŒºåŸŸï¼‰                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ æ ‡é¢˜ï¼šä¸€å¥è¯ç”Ÿæˆå‰§æœ¬          â”‚                     â”‚
â”‚  â”‚                            â”‚                     â”‚
â”‚  â”‚ [å¤šè¡Œæ–‡æœ¬è¾“å…¥æ¡†]            â”‚                     â”‚
â”‚  â”‚  æç¤ºï¼šæè¿°ä½ çš„æ•…äº‹æƒ³æ³•      â”‚                     â”‚
â”‚  â”‚  â€¢ æ ¸å¿ƒä¸»é¢˜                 â”‚                     â”‚
â”‚  â”‚  â€¢ ä¸»è¦æƒ…èŠ‚çº¿               â”‚                     â”‚
â”‚  â”‚  â€¢ äººç‰©æ€§æ ¼                 â”‚                     â”‚
â”‚  â”‚  â€¢ æƒ…æ„Ÿèµ°å‘...              â”‚                     â”‚
â”‚  â”‚                            â”‚                     â”‚
â”‚  â”‚ [ç”Ÿæˆå®Œæ•´æ•…äº‹] æŒ‰é’®          â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                      â”‚
â”‚  å³ä¾§ï¼ˆç”Ÿæˆç»“æœï¼‰                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ æ ‡é¢˜ï¼šç”Ÿæˆç»“æœ               â”‚                     â”‚
â”‚  â”‚ [ä¸€é”®å¤åˆ¶å…¨æ–‡] æŒ‰é’®          â”‚                     â”‚
â”‚  â”‚                            â”‚                     â”‚
â”‚  â”‚ [æ»šåŠ¨åŒºåŸŸ - æ˜¾ç¤ºç”Ÿæˆçš„æ•…äº‹]  â”‚                     â”‚
â”‚  â”‚                            â”‚                     â”‚
â”‚  â”‚ [ä¿å­˜ç»“æœ] æŒ‰é’®              â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°æ®å­˜å‚¨**ï¼š
```dart
SharedPreferences:
  - 'story_input': "ç”¨æˆ·è¾“å…¥çš„æ•…äº‹åˆ›æ„"
  - 'story_output': "AI ç”Ÿæˆçš„å®Œæ•´æ•…äº‹"
  - 'story_prompt_template': "æ‰€é€‰æ¨¡æ¿ ID"
```

**æ“ä½œæµç¨‹**ï¼š
1. ç”¨æˆ·åœ¨å·¦ä¾§è¾“å…¥æ•…äº‹åˆ›æ„
2. ï¼ˆå¯é€‰ï¼‰ç‚¹å‡»"æç¤ºè¯æ¨¡æ¿"é€‰æ‹©é¢„è®¾é£æ ¼ï¼ˆç§‘å¹»/çˆ±æƒ…/æ‚¬ç–‘ç­‰ï¼‰
3. ç‚¹å‡»"ç”Ÿæˆå®Œæ•´æ•…äº‹"æŒ‰é’®
4. è°ƒç”¨ LLM APIï¼ˆä½¿ç”¨ ApiManagerï¼‰
5. å³ä¾§æ˜¾ç¤ºç”Ÿæˆç»“æœ
6. ç”¨æˆ·å¯ä»¥ï¼š
   - å¤åˆ¶åˆ°å‰ªè´´æ¿
   - ä¿å­˜åˆ° SharedPreferences
   - æ‰‹åŠ¨å¤åˆ¶åˆ°"å‰§æœ¬ç”Ÿæˆ"é¢æ¿

#### 3.3.2 ğŸ“ å‰§æœ¬ç”Ÿæˆé¢æ¿ (ScriptGenerationPanel)

**åŠŸèƒ½**ï¼šå°†æ•…äº‹è½¬æ¢ä¸ºå‰§æœ¬æ ¼å¼

**ç•Œé¢å¸ƒå±€**ï¼šä¸æ•…äº‹ç”Ÿæˆç±»ä¼¼ï¼Œå·¦å³ä¸¤æ 

**æ•°æ®å­˜å‚¨**ï¼š
```dart
SharedPreferences:
  - 'script_input': "è¾“å…¥å†…å®¹ï¼ˆå¯èƒ½æ¥è‡ªæ•…äº‹ç”Ÿæˆï¼‰"
  - 'script_output': "ç”Ÿæˆçš„å‰§æœ¬"
  - 'script_prompt_template': "æ‰€é€‰æ¨¡æ¿ ID"
```

**æ“ä½œæµç¨‹**ï¼š
1. ç”¨æˆ·è¾“å…¥æˆ–ä»"æ•…äº‹ç”Ÿæˆ"ç²˜è´´å†…å®¹
2. é€‰æ‹©å‰§æœ¬é£æ ¼æ¨¡æ¿ï¼ˆæ‚¬ç–‘/çˆ±æƒ…/åŠ¨ä½œç‰‡ç­‰ï¼‰
3. ç‚¹å‡»ç”Ÿæˆ
4. æŸ¥çœ‹å‰§æœ¬ç»“æœ
5. å¯æ‰‹åŠ¨å¤åˆ¶åˆ°"åˆ†é•œç”Ÿæˆ"é¢æ¿

#### 3.3.3 ğŸ¬ åˆ†é•œç”Ÿæˆé¢æ¿ (StoryboardGenerationPanel)

**åŠŸèƒ½**ï¼šå°†å‰§æœ¬æ‹†åˆ†ä¸ºå¤šä¸ªåœºæ™¯ï¼Œä¸ºæ¯ä¸ªåœºæ™¯ç”Ÿæˆå›¾ç‰‡/è§†é¢‘æç¤ºè¯

**ç•Œé¢å¸ƒå±€**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¡¶éƒ¨ï¼šæ ‡é¢˜ + æç¤ºè¯æ¨¡æ¿é€‰æ‹©                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  å·¦ä¾§ï¼ˆè¾“å…¥åŒºåŸŸï¼‰                                     â”‚
â”‚  - å‰§æœ¬è¾“å…¥æ¡†ï¼ˆå¯ä»å‰§æœ¬é¢æ¿ç²˜è´´ï¼‰                      â”‚
â”‚  - å›¾ç‰‡æç¤ºè¯é£æ ¼é€‰æ‹©                                 â”‚
â”‚  - è§†é¢‘æç¤ºè¯é£æ ¼é€‰æ‹©                                 â”‚
â”‚  - [ç”Ÿæˆåˆ†é•œ] æŒ‰é’®                                    â”‚
â”‚                                                      â”‚
â”‚  å³ä¾§ï¼ˆåˆ†é•œåˆ—è¡¨ï¼‰                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ åœºæ™¯ 1                      â”‚                     â”‚
â”‚  â”‚ â€¢ å‰§æœ¬ï¼šxxx                 â”‚                     â”‚
â”‚  â”‚ â€¢ å›¾ç‰‡æç¤ºè¯ï¼šxxx           â”‚                     â”‚
â”‚  â”‚ â€¢ è§†é¢‘æç¤ºè¯ï¼šxxx           â”‚                     â”‚
â”‚  â”‚ [ç¼–è¾‘] [åˆ é™¤]               â”‚                     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
â”‚  â”‚ åœºæ™¯ 2                      â”‚                     â”‚
â”‚  â”‚ ...                        â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                      â”‚
â”‚  [æ‰¹é‡ç”Ÿæˆå›¾ç‰‡] [æ‰¹é‡ç”Ÿæˆè§†é¢‘]                         â”‚
â”‚  [æ·»åŠ åœºæ™¯] [æ¸…ç©ºå…¨éƒ¨]                                â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°æ®å­˜å‚¨**ï¼š
```dart
SharedPreferences:
  - 'storyboards': JSON æ•°ç»„
    [
      {
        'scene': 'åœºæ™¯1',
        'script': 'åœºæ™¯å‰§æœ¬å†…å®¹',
        'imagePrompt': 'è‹±æ–‡å›¾ç‰‡æç¤ºè¯',
        'videoPrompt': 'è‹±æ–‡è§†é¢‘æç¤ºè¯'
      },
      {
        'scene': 'åœºæ™¯2',
        ...
      }
    ]
  - 'storyboard_image_prompt_template': "å›¾ç‰‡é£æ ¼æ¨¡æ¿ ID"
  - 'storyboard_video_prompt_template': "è§†é¢‘é£æ ¼æ¨¡æ¿ ID"
```

**æ“ä½œæµç¨‹**ï¼š
1. ç”¨æˆ·è¾“å…¥å‰§æœ¬æˆ–ä»"å‰§æœ¬ç”Ÿæˆ"ç²˜è´´
2. é€‰æ‹©å›¾ç‰‡/è§†é¢‘æç¤ºè¯é£æ ¼
3. ç‚¹å‡»"ç”Ÿæˆåˆ†é•œ"
4. AI å°†å‰§æœ¬æ‹†åˆ†ä¸ºå¤šä¸ªåœºæ™¯ï¼Œæ¯ä¸ªåœºæ™¯ç”Ÿæˆï¼š
   - åœºæ™¯å‰§æœ¬ï¼ˆä¸­æ–‡ï¼‰
   - å›¾ç‰‡æç¤ºè¯ï¼ˆè‹±æ–‡ï¼‰
   - è§†é¢‘æç¤ºè¯ï¼ˆè‹±æ–‡ï¼‰
5. ç”¨æˆ·å¯ä»¥ï¼š
   - ç¼–è¾‘æ¯ä¸ªåœºæ™¯
   - æ·»åŠ æ–°åœºæ™¯
   - åˆ é™¤åœºæ™¯
   - æ‰¹é‡ç”Ÿæˆå›¾ç‰‡/è§†é¢‘

#### 3.3.4 ğŸ‘¤ è§’è‰²ç”Ÿæˆé¢æ¿ (CharacterGenerationPanel)

**åŠŸèƒ½**ï¼šç”Ÿæˆè§’è‰²å›¾ç‰‡ã€åˆ›å»ºæ•°å­—åˆ†èº«ï¼ˆCharacterï¼‰

**ç•Œé¢å¸ƒå±€**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¡¶éƒ¨ï¼šæ ‡é¢˜ + æ“ä½œæŒ‰é’®                                  â”‚
â”‚ [æ ¹æ®å‰§æœ¬ç”Ÿæˆ] [å‚è€ƒé£æ ¼] [æ¸…ç©ºå‚è€ƒ] [æ¸…ç©ºæ‰€æœ‰è§’è‰²]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  å·¦ä¾§ï¼ˆè¾“å…¥åŒºåŸŸï¼‰                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ è§’è‰²æè¿°è¾“å…¥æ¡†               â”‚                     â”‚
â”‚  â”‚                            â”‚                     â”‚
â”‚  â”‚ [ç”Ÿæˆè§’è‰²å›¾ç‰‡] æŒ‰é’®          â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                      â”‚
â”‚  "å‚è€ƒé£æ ¼"åŠŸèƒ½ï¼ˆå›¾ç”Ÿå›¾ï¼‰                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ [ä¸Šä¼ å‚è€ƒå›¾ç‰‡]              â”‚                     â”‚
â”‚  â”‚ å‚è€ƒå›¾ç‰‡é¢„è§ˆ                â”‚                     â”‚
â”‚  â”‚ å‚è€ƒé£æ ¼æç¤ºè¯è¾“å…¥           â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                      â”‚
â”‚  å³ä¾§ï¼ˆè§’è‰²åˆ—è¡¨ï¼‰                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚è§’è‰²1 â”‚è§’è‰²2 â”‚è§’è‰²3 â”‚è§’è‰²4 â”‚                         â”‚
â”‚  â”‚[img]â”‚[img]â”‚[img]â”‚[img]â”‚                         â”‚
â”‚  â”‚ [X] â”‚ [X] â”‚ [X] â”‚ [X] â”‚                         â”‚
â”‚  â”‚[åˆ›å»º]â”‚[åˆ›å»º]â”‚[åˆ›å»º]â”‚[åˆ›å»º]â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                      â”‚
â”‚  åˆ›å»ºæ•°å­—åˆ†èº«åŠŸèƒ½                                     â”‚
â”‚  â€¢ ä¸Šä¼ è§†é¢‘ â†’ Supabase                              â”‚
â”‚  â€¢ è°ƒç”¨ createCharacter API                         â”‚
â”‚  â€¢ è·å– Character ID                                â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°æ®å­˜å‚¨**ï¼š
```dart
SharedPreferences:
  - 'workspace_characters': JSON æ•°ç»„
    [
      {
        'imageUrl': 'https://...',
        'localPath': '/path/to/image',
        'characterId': 'char_xxx' // å¦‚æœåˆ›å»ºäº†æ•°å­—åˆ†èº«
      }
    ]
  - 'character_reference_style_image': "/path/to/reference.jpg"
  - 'character_reference_style_prompt': "å‚è€ƒé£æ ¼æè¿°"
```

**ç‰¹æ®ŠåŠŸèƒ½**ï¼š

**1. æ ¹æ®å‰§æœ¬ç”Ÿæˆè§’è‰²**
- ç‚¹å‡»"æ ¹æ®å‰§æœ¬ç”Ÿæˆ"æŒ‰é’®
- ä» SharedPreferences è¯»å– `script_output`
- è°ƒç”¨ LLM API æå–è§’è‰²åˆ—è¡¨
- ä¸ºæ¯ä¸ªè§’è‰²ç”Ÿæˆå›¾ç‰‡

**2. å‚è€ƒé£æ ¼ï¼ˆå›¾ç”Ÿå›¾ï¼‰**
- ä¸Šä¼ å‚è€ƒå›¾ç‰‡ï¼ˆå¦‚åŠ¨æ¼«è§’è‰²ï¼‰
- è¾“å…¥å‚è€ƒé£æ ¼æè¿°
- ç”Ÿæˆè§’è‰²æ—¶ï¼ŒAPI ä¼šå‚è€ƒä¸Šä¼ çš„å›¾ç‰‡é£æ ¼

**3. åˆ›å»ºæ•°å­—åˆ†èº«ï¼ˆCharacterï¼‰**
- é€‰ä¸­ä¸€ä¸ªè§’è‰²
- ç‚¹å‡»"åˆ›å»ºè§’è‰²"æŒ‰é’®
- ä¸Šä¼ è§†é¢‘åˆ° Supabase
- è°ƒç”¨ `createCharacter` API
- è·å¾— Character IDï¼ˆå¯ç”¨äºè§†é¢‘ç”Ÿæˆï¼‰

#### 3.3.5 ğŸï¸ åœºæ™¯ç”Ÿæˆé¢æ¿ (SceneGenerationPanel)

**åŠŸèƒ½**ï¼šç”Ÿæˆåœºæ™¯èƒŒæ™¯å›¾ç‰‡

**ç•Œé¢å¸ƒå±€**ï¼šä¸è§’è‰²ç”Ÿæˆç±»ä¼¼

**æ•°æ®å­˜å‚¨**ï¼š
```dart
SharedPreferences:
  - 'scenes': JSON æ•°ç»„
    [
      {
        'name': 'åœºæ™¯åç§°',
        'imageUrl': 'https://...',
        'localPath': '/path/to/image'
      }
    ]
```

#### 3.3.6 ğŸ¨ ç‰©å“ç”Ÿæˆé¢æ¿ (PropGenerationPanel)

**åŠŸèƒ½**ï¼šç”Ÿæˆé“å…·/ç‰©å“å›¾ç‰‡

**ç•Œé¢å¸ƒå±€**ï¼šä¸åœºæ™¯ç”Ÿæˆç±»ä¼¼

**æ•°æ®å­˜å‚¨**ï¼š
```dart
SharedPreferences:
  - 'props': JSON æ•°ç»„
    [
      {
        'name': 'ç‰©å“åç§°',
        'imageUrl': 'https://...',
        'localPath': '/path/to/image'
      }
    ]
```

### 3.4 æ‰‹åŠ¨æ¨¡å¼çš„æ•°æ®å…³è”

#### å…³è”æ–¹å¼ 1ï¼šæ‰‹åŠ¨å¤åˆ¶ç²˜è´´

```
æ•…äº‹ç”Ÿæˆ â”€â”
          â”œâ”€â†’ [å¤åˆ¶æŒ‰é’®] â”€â†’ å‰ªè´´æ¿ â”€â†’ [ç²˜è´´] â”€â†’ å‰§æœ¬ç”Ÿæˆ
å‰§æœ¬ç”Ÿæˆ â”€â”˜
```

#### å…³è”æ–¹å¼ 2ï¼šä» SharedPreferences è¯»å–

```
å‰§æœ¬ç”Ÿæˆä¿å­˜ â†’ SharedPreferences['script_output']
                      â†“
è§’è‰²ç”Ÿæˆé¢æ¿ â†’ [æ ¹æ®å‰§æœ¬ç”Ÿæˆ] æŒ‰é’®
                      â†“
è¯»å– SharedPreferences['script_output'] â†’ æå–è§’è‰²
```

#### å…³è”æ–¹å¼ 3ï¼šç´ æåº“å…±äº«

```
è§’è‰²ç”Ÿæˆ â†’ ç”Ÿæˆçš„å›¾ç‰‡ â”€â”
åœºæ™¯ç”Ÿæˆ â†’ ç”Ÿæˆçš„å›¾ç‰‡ â”€â”¼â†’ ç´ æåº“ï¼ˆGeneratedMediaManagerï¼‰
ç‰©å“ç”Ÿæˆ â†’ ç”Ÿæˆçš„å›¾ç‰‡ â”€â”˜
                      â†“
            å¯åœ¨"è§†é¢‘ç©ºé—´"é€‰æ‹©ä½¿ç”¨
```

### 3.5 æ‰‹åŠ¨æ¨¡å¼çš„å·¥ä½œåŒºçŠ¶æ€ï¼ˆWorkspaceStateï¼‰

```dart
// lib/main.dart

/// å·¥ä½œåŒºå…±äº«çŠ¶æ€ï¼ˆæ‰‹åŠ¨æ¨¡å¼å…¨å±€ï¼‰
class WorkspaceState extends ChangeNotifier {
  static final WorkspaceState _instance = WorkspaceState._internal();
  factory WorkspaceState() => _instance;
  
  // å…±äº«æ•°æ®
  String script = '';          // å½“å‰å‰§æœ¬
  String story = '';           // å½“å‰æ•…äº‹
  List<Character> characters = [];  // è§’è‰²åˆ—è¡¨
  
  // åŠ è½½æ•°æ®ï¼ˆä» SharedPreferencesï¼‰
  Future<void> loadCharacters() async {
    final prefs = await SharedPreferences.getInstance();
    final json = prefs.getString('workspace_characters');
    if (json != null) {
      characters = parseCharacters(json);
      notifyListeners();
    }
  }
  
  // ä¿å­˜æ•°æ®
  Future<void> saveCharacters() async {
    final prefs = await SharedPreferences.getInstance();
    await prefs.setString('workspace_characters', jsonEncode(characters));
  }
}
```

---

## 4. æ•°æ®æ¨¡å‹å’Œå…³è”

### 4.1 æ‰‹åŠ¨æ¨¡å¼æ•°æ®æ¨¡å‹

#### SharedPreferences é”®å€¼è¡¨

| é”®å | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `story_input` | String | æ•…äº‹è¾“å…¥ | "ä¸€ä¸ªå‹‡æ•¢çš„å°çŒ«" |
| `story_output` | String | ç”Ÿæˆçš„æ•…äº‹ | "ä»å‰æœ‰ä¸€åªå°çŒ«..." |
| `story_prompt_template` | String | æ•…äº‹æ¨¡æ¿ ID | "template_scifi" |
| `script_input` | String | å‰§æœ¬è¾“å…¥ | "..." |
| `script_output` | String | ç”Ÿæˆçš„å‰§æœ¬ | "åœºæ™¯1ï¼š..." |
| `script_prompt_template` | String | å‰§æœ¬æ¨¡æ¿ ID | "template_drama" |
| `storyboards` | JSON String | åˆ†é•œåˆ—è¡¨ | `[{scene:1,...}]` |
| `workspace_characters` | JSON String | è§’è‰²åˆ—è¡¨ | `[{imageUrl:...}]` |
| `character_reference_style_image` | String | å‚è€ƒå›¾ç‰‡è·¯å¾„ | "/path/to/image" |
| `character_reference_style_prompt` | String | å‚è€ƒé£æ ¼æè¿° | "åŠ¨æ¼«é£æ ¼" |
| `scenes` | JSON String | åœºæ™¯åˆ—è¡¨ | `[{name:...}]` |
| `props` | JSON String | ç‰©å“åˆ—è¡¨ | `[{name:...}]` |

### 4.2 å…¨å±€ç®¡ç†å™¨ï¼ˆManagersï¼‰

#### GeneratedMediaManagerï¼ˆç”Ÿæˆå†…å®¹ç®¡ç†å™¨ï¼‰

```dart
// lib/main.dart

/// ç”Ÿæˆå†…å®¹ç®¡ç†å™¨ - ç®¡ç†æ‰€æœ‰ AI ç”Ÿæˆçš„å›¾ç‰‡/è§†é¢‘
class GeneratedMediaManager extends ChangeNotifier {
  static final GeneratedMediaManager _instance = GeneratedMediaManager._internal();
  factory GeneratedMediaManager() => _instance;
  
  // ç”Ÿæˆçš„å›¾ç‰‡åˆ—è¡¨ï¼ˆä»"ç»˜å›¾ç©ºé—´"ç”Ÿæˆï¼‰
  List<String> generatedImages = [];
  
  // ç”Ÿæˆçš„è§†é¢‘åˆ—è¡¨ï¼ˆä»"è§†é¢‘ç©ºé—´"ç”Ÿæˆï¼‰
  List<String> generatedVideos = [];
  
  // æ·»åŠ å›¾ç‰‡
  void addImage(String imageUrl) {
    generatedImages.add(imageUrl);
    notifyListeners();
    _saveToPrefs();
  }
  
  // æ¸…ç©ºå›¾ç‰‡
  void clearImages() {
    generatedImages.clear();
    notifyListeners();
    _saveToPrefs();
  }
  
  // æŒä¹…åŒ–åˆ° SharedPreferences
  Future<void> _saveToPrefs() async {
    final prefs = await SharedPreferences.getInstance();
    await prefs.setStringList('generated_images', generatedImages);
    await prefs.setStringList('generated_videos', generatedVideos);
  }
  
  // ä» SharedPreferences åŠ è½½
  Future<void> loadMedia() async {
    final prefs = await SharedPreferences.getInstance();
    generatedImages = prefs.getStringList('generated_images') ?? [];
    generatedVideos = prefs.getStringList('generated_videos') ?? [];
    notifyListeners();
  }
}
```

#### WorkspaceStateï¼ˆå·¥ä½œåŒºçŠ¶æ€ï¼‰

```dart
/// å·¥ä½œåŒºçŠ¶æ€ - æ‰‹åŠ¨æ¨¡å¼çš„å…±äº«çŠ¶æ€
class WorkspaceState extends ChangeNotifier {
  String script = '';
  String story = '';
  List<Map<String, dynamic>> characters = [];
  
  // ä» SharedPreferences åŠ è½½
  Future<void> loadScript() async {
    final prefs = await SharedPreferences.getInstance();
    script = prefs.getString('script_output') ?? '';
    notifyListeners();
  }
}
```

---

## 5. ç•Œé¢æ¶æ„

### 5.1 åº”ç”¨æ•´ä½“ç»“æ„

```
MaterialApp (main.dart)
â””â”€ HomePage (é¦–é¡µ)
    â”œâ”€ æ¡Œé¢å¸ƒå±€
    â”‚   â”œâ”€ å·¦ä¾§å¯¼èˆªæ ï¼ˆSidebarMenuï¼‰
    â”‚   â”‚   â”œâ”€ åˆ›ä½œç©ºé—´ (projects)
    â”‚   â”‚   â”œâ”€ ç»˜å›¾ç©ºé—´ (drawing)
    â”‚   â”‚   â”œâ”€ è§†é¢‘ç©ºé—´ (video)
    â”‚   â”‚   â”œâ”€ ç´ æåº“ (materials)
    â”‚   â”‚   â””â”€ ç³»ç»Ÿæ—¥å¿— (logs)
    â”‚   â””â”€ å³ä¾§å†…å®¹åŒºï¼ˆæ ¹æ®é€‰ä¸­èœå•åˆ‡æ¢ï¼‰
    â”‚
    â””â”€ ç§»åŠ¨ç«¯å¸ƒå±€
        â”œâ”€ é¡¶éƒ¨æ 
        â”œâ”€ å†…å®¹åŒº
        â””â”€ åº•éƒ¨å¯¼èˆªæ 
```

### 5.2 æ‰‹åŠ¨æ¨¡å¼ä¸»ç•Œé¢ï¼ˆWorkspaceShellï¼‰

```dart
// ä½ç½®ï¼šlib/main.dart

class WorkspaceShell extends StatefulWidget {
  final Map<String, dynamic>? projectData;
  
  @override
  _WorkspaceShellState createState() => _WorkspaceShellState();
}

class _WorkspaceShellState extends State<WorkspaceShell> {
  int _currentTab = 0;
  
  // 6 ä¸ªåŠŸèƒ½é¢æ¿
  final List<Widget> _pages = [
    StoryGenerationPanel(),      // 0: æ•…äº‹ç”Ÿæˆ
    ScriptGenerationPanel(),     // 1: å‰§æœ¬ç”Ÿæˆ
    StoryboardGenerationPanel(), // 2: åˆ†é•œç”Ÿæˆ
    CharacterGenerationPanel(),  // 3: è§’è‰²ç”Ÿæˆ
    SceneGenerationPanel(),      // 4: åœºæ™¯ç”Ÿæˆ
    PropGenerationPanel(),       // 5: ç‰©å“ç”Ÿæˆ
  ];
  
  @override
  Widget build(BuildContext context) {
    final screenType = ResponsiveLayout.currentScreenType(context);
    
    if (screenType == ScreenType.mobile) {
      return _buildMobileLayout();  // ç§»åŠ¨ç«¯å¸ƒå±€
    } else {
      return _buildDesktopLayout(); // æ¡Œé¢/å¹³æ¿å¸ƒå±€
    }
  }
  
  // æ¡Œé¢å¸ƒå±€ï¼šå·¦ä¾§å¯¼èˆª + å³ä¾§å†…å®¹
  Widget _buildDesktopLayout() {
    return Row(
      children: [
        _buildNavigationRail(),  // å·¦ä¾§å¯¼èˆªæ 
        Expanded(
          child: Column(
            children: [
              _buildTopBar(),  // é¡¶éƒ¨æ 
              Expanded(
                child: AnimatedSwitcher(
                  duration: Duration(milliseconds: 300),
                  child: _pages[_currentTab],  // å½“å‰é¢æ¿
                ),
              ),
            ],
          ),
        ),
      ],
    );
  }
  
  // ç§»åŠ¨ç«¯å¸ƒå±€ï¼šé¡¶éƒ¨æ  + å†…å®¹ + åº•éƒ¨å¯¼èˆª
  Widget _buildMobileLayout() {
    return Column(
      children: [
        _buildTopBar(),
        Expanded(
          child: AnimatedSwitcher(
            duration: Duration(milliseconds: 300),
            child: _pages[_currentTab],
          ),
        ),
        _buildBottomNavigationBar(),
      ],
    );
  }
  
  // å·¦ä¾§å¯¼èˆªæ ï¼ˆæ¡Œé¢ï¼‰
  Widget _buildNavigationRail() {
    return Container(
      width: 200,
      child: Column(
        children: [
          // Logo å’Œæ ‡é¢˜
          _buildHeader(),
          Divider(),
          // å¯¼èˆªé¡¹åˆ—è¡¨
          Expanded(
            child: ListView.builder(
              itemCount: _navItems.length,
              itemBuilder: (context, index) {
                return _buildNavItem(index);
              },
            ),
          ),
          // åº•éƒ¨æ“ä½œ
          _buildFooter(),
        ],
      ),
    );
  }
  
  // åº•éƒ¨å¯¼èˆªæ ï¼ˆç§»åŠ¨ç«¯ï¼‰
  Widget _buildBottomNavigationBar() {
    return BottomNavigationBar(
      currentIndex: _currentTab,
      onTap: (index) => setState(() => _currentTab = index),
      items: _navItems.map((item) {
        final (icon, label) = item;
        return BottomNavigationBarItem(
          icon: Icon(icon),
          label: label,
        );
      }).toList(),
    );
  }
}
```

### 5.3 å“åº”å¼å¸ƒå±€

```dart
// å±å¹•æ–­ç‚¹
enum ScreenType {
  mobile,   // < 600px
  tablet,   // 600px - 1200px
  desktop,  // > 1200px
}

class ResponsiveLayout {
  static ScreenType currentScreenType(BuildContext context) {
    final width = MediaQuery.of(context).size.width;
    if (width < 600) return ScreenType.mobile;
    if (width < 1200) return ScreenType.tablet;
    return ScreenType.desktop;
  }
  
  static bool isMobile(BuildContext context) {
    return currentScreenType(context) == ScreenType.mobile;
  }
  
  static bool isDesktop(BuildContext context) {
    return currentScreenType(context) == ScreenType.desktop;
  }
}
```

---

## 6. API æ¶æ„

### 6.1 æ··åˆä¾›åº”å•†æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ApiManagerï¼ˆå•ä¾‹ç®¡ç†å™¨ï¼‰             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ _llmProvider: BaseApiProvider          â”‚
â”‚  â€¢ _imageProvider: BaseApiProvider        â”‚
â”‚  â€¢ _videoProvider: BaseApiProvider        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  chatCompletion() â†’ _llmProvider          â”‚
â”‚  generateImage() â†’ _imageProvider         â”‚
â”‚  createVideo() â†’ _videoProvider           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“              â†“              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Geeknow â”‚    â”‚OpenAI  â”‚    â”‚Custom  â”‚
    â”‚Providerâ”‚    â”‚Providerâ”‚    â”‚Providerâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç‰¹æ€§**ï¼š
- âœ… **åˆ†ç¦»é…ç½®**ï¼šLLM/å›¾ç‰‡/è§†é¢‘å¯é€‰æ‹©ä¸åŒä¾›åº”å•†
- âœ… **æ’ä»¶åŒ–**ï¼šæ–°ä¾›åº”å•†åªéœ€ç»§æ‰¿ `BaseApiProvider`
- âœ… **ç¼“å­˜æœºåˆ¶**ï¼šé¿å…é‡å¤åˆ›å»ºç›¸åŒé…ç½®çš„ Provider

### 6.2 API è°ƒç”¨æµç¨‹

```
ç”¨æˆ·æ“ä½œï¼ˆç‚¹å‡»ç”ŸæˆæŒ‰é’®ï¼‰
    â†“
UI å±‚ï¼ˆStatefulWidgetï¼‰
    â†“
è°ƒç”¨ ApiManager().chatCompletion()
    â†“
ApiManager è½¬å‘åˆ° _llmProvider.chatCompletion()
    â†“
GeeknowProvider å‘é€ HTTP è¯·æ±‚
    â†“
è§£æå“åº”ï¼ˆåœ¨ Isolate ä¸­ï¼‰
    â†“
è¿”å›ç»“æœç»™ UI
    â†“
UI æ›´æ–°æ˜¾ç¤º
```

---

## 7. æ•°æ®æµ

### 7.1 æ‰‹åŠ¨æ¨¡å¼æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ç”¨æˆ·æ“ä½œï¼ˆUIå±‚ï¼‰                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              StatefulWidget State                   â”‚
â”‚  â€¢ _inputController: è¾“å…¥æ¡†æ§åˆ¶å™¨                    â”‚
â”‚  â€¢ _isLoading: åŠ è½½çŠ¶æ€                             â”‚
â”‚  â€¢ _generatedResult: ç”Ÿæˆç»“æœ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                API è°ƒç”¨ï¼ˆæœåŠ¡å±‚ï¼‰                     â”‚
â”‚  ApiManager().chatCompletion(...)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             SharedPreferencesï¼ˆæŒä¹…åŒ–ï¼‰              â”‚
â”‚  await prefs.setString('story_output', result);    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              UI æ›´æ–°ï¼ˆsetStateï¼‰                     â”‚
â”‚  setState(() { _generatedResult = result; });      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 é¢æ¿é—´æ•°æ®ä¼ é€’

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•…äº‹ç”Ÿæˆé¢æ¿                               â”‚
â”‚  â€¢ ç”¨æˆ·ç”Ÿæˆæ•…äº‹                             â”‚
â”‚  â€¢ ç‚¹å‡»"ä¸€é”®å¤åˆ¶å…¨æ–‡"                       â”‚
â”‚  â€¢ å¤åˆ¶åˆ°ç³»ç»Ÿå‰ªè´´æ¿                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
         ï¼ˆç”¨æˆ·æ‰‹åŠ¨åˆ‡æ¢é¢æ¿ï¼‰
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰§æœ¬ç”Ÿæˆé¢æ¿                               â”‚
â”‚  â€¢ ç”¨æˆ·ç²˜è´´å†…å®¹åˆ°è¾“å…¥æ¡†                     â”‚
â”‚  â€¢ ç”Ÿæˆå‰§æœ¬                                â”‚
â”‚  â€¢ ä¿å­˜åˆ° SharedPreferences                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
         ï¼ˆç”¨æˆ·æ‰‹åŠ¨åˆ‡æ¢é¢æ¿ï¼‰
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è§’è‰²ç”Ÿæˆé¢æ¿                               â”‚
â”‚  â€¢ ç‚¹å‡»"æ ¹æ®å‰§æœ¬ç”Ÿæˆ"                       â”‚
â”‚  â€¢ ä» SharedPreferences è¯»å– script_output â”‚
â”‚  â€¢ è°ƒç”¨ LLM æå–è§’è‰²                       â”‚
â”‚  â€¢ æ‰¹é‡ç”Ÿæˆè§’è‰²å›¾ç‰‡                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. çŠ¶æ€ç®¡ç†

### 8.1 æ‰‹åŠ¨æ¨¡å¼çŠ¶æ€ç®¡ç†ç­–ç•¥

| å±‚çº§ | ç®¡ç†æ–¹å¼ | ç¤ºä¾‹ |
|------|---------|------|
| **é¢æ¿å†…éƒ¨çŠ¶æ€** | `StatefulWidget` + `setState` | è¾“å…¥æ¡†å†…å®¹ã€åŠ è½½çŠ¶æ€ |
| **è·¨é¢æ¿å…±äº«** | `WorkspaceState` (ChangeNotifier) | å‰§æœ¬ã€æ•…äº‹ã€è§’è‰²åˆ—è¡¨ |
| **å…¨å±€é…ç½®** | `ApiConfigManager` (ChangeNotifier) | API é…ç½® |
| **ç”Ÿæˆå†…å®¹** | `GeneratedMediaManager` (ChangeNotifier) | å›¾ç‰‡/è§†é¢‘åˆ—è¡¨ |

### 8.2 é¢æ¿å†…éƒ¨çŠ¶æ€ç¤ºä¾‹

```dart
class StoryGenerationPanel extends StatefulWidget {
  @override
  _StoryGenerationPanelState createState() => _StoryGenerationPanelState();
}

class _StoryGenerationPanelState extends State<StoryGenerationPanel> {
  // é¢æ¿å†…éƒ¨çŠ¶æ€
  final TextEditingController _inputController = TextEditingController();
  String? _generatedStory;
  bool _isLoading = false;
  String? _selectedTemplate;
  
  @override
  void initState() {
    super.initState();
    _loadSavedData();  // ä» SharedPreferences åŠ è½½
  }
  
  // åŠ è½½ä¿å­˜çš„æ•°æ®
  Future<void> _loadSavedData() async {
    final prefs = await SharedPreferences.getInstance();
    setState(() {
      _inputController.text = prefs.getString('story_input') ?? '';
      _generatedStory = prefs.getString('story_output');
      _selectedTemplate = prefs.getString('story_prompt_template');
    });
  }
  
  // ä¿å­˜æ•°æ®
  Future<void> _saveData() async {
    final prefs = await SharedPreferences.getInstance();
    await prefs.setString('story_input', _inputController.text);
    if (_generatedStory != null) {
      await prefs.setString('story_output', _generatedStory!);
    }
    if (_selectedTemplate != null) {
      await prefs.setString('story_prompt_template', _selectedTemplate!);
    }
  }
  
  // ç”Ÿæˆæ•…äº‹
  Future<void> _generateStory() async {
    setState(() => _isLoading = true);
    
    try {
      final result = await ApiManager().chatCompletion(
        model: apiConfigManager.llmModel,
        messages: [
          {'role': 'user', 'content': _inputController.text},
        ],
      );
      
      setState(() {
        _generatedStory = result;
        _isLoading = false;
      });
      
      await _saveData();  // è‡ªåŠ¨ä¿å­˜
    } catch (e) {
      setState(() => _isLoading = false);
      // æ˜¾ç¤ºé”™è¯¯
    }
  }
  
  @override
  Widget build(BuildContext context) {
    return Padding(
      padding: EdgeInsets.all(28),
      child: Column(
        children: [
          // æ ‡é¢˜å’Œæ¨¡æ¿é€‰æ‹©å™¨
          Row(
            children: [
              Expanded(child: _buildHeader()),
              _buildTemplateSelector(),
            ],
          ),
          SizedBox(height: 28),
          // å·¦å³ä¸¤æ å¸ƒå±€
          Expanded(
            child: Row(
              children: [
                // å·¦ä¾§ï¼šè¾“å…¥åŒºåŸŸ
                Expanded(
                  child: _buildInputArea(),
                ),
                SizedBox(width: 20),
                // å³ä¾§ï¼šç”Ÿæˆç»“æœ
                Expanded(
                  child: _buildResultArea(),
                ),
              ],
            ),
          ),
        ],
      ),
    );
  }
}
```

---

## 9. æ•°æ®æŒä¹…åŒ–

### 9.1 æ‰‹åŠ¨æ¨¡å¼æŒä¹…åŒ–ç­–ç•¥

```dart
// ä¿å­˜æ—¶æœº
1. ç”¨æˆ·ç‚¹å‡»"ä¿å­˜"æŒ‰é’®
2. ç”Ÿæˆå®Œæˆåè‡ªåŠ¨ä¿å­˜
3. åˆ‡æ¢é¢æ¿æ—¶è‡ªåŠ¨ä¿å­˜ï¼ˆonPauseï¼‰
4. åº”ç”¨é€€å‡ºæ—¶è‡ªåŠ¨ä¿å­˜ï¼ˆAppLifecycleState.pausedï¼‰

// åŠ è½½æ—¶æœº
1. é¢æ¿ initState() æ—¶åŠ è½½
2. åº”ç”¨å¯åŠ¨æ—¶åŠ è½½
```

### 9.2 SharedPreferences æ“ä½œå°è£…

```dart
/// SharedPreferences å·¥å…·ç±»
class PrefsHelper {
  static Future<void> saveString(String key, String value) async {
    final prefs = await SharedPreferences.getInstance();
    await prefs.setString(key, value);
  }
  
  static Future<String?> getString(String key) async {
    final prefs = await SharedPreferences.getInstance();
    return prefs.getString(key);
  }
  
  static Future<void> saveJson(String key, dynamic data) async {
    final json = jsonEncode(data);
    await saveString(key, json);
  }
  
  static Future<dynamic> getJson(String key) async {
    final json = await getString(key);
    if (json == null) return null;
    return jsonDecode(json);
  }
}
```

---

## 10. ä»£ç ç»“æ„

### 10.1 æ–‡ä»¶ç»„ç»‡

```
lib/
â”œâ”€â”€ main.dart                          # åº”ç”¨å…¥å£ + æ‰‹åŠ¨æ¨¡å¼ UIï¼ˆ19000+ è¡Œï¼‰
â”‚   â”œâ”€â”€ AnimeApp                      # åº”ç”¨æ ¹ Widget
â”‚   â”œâ”€â”€ HomePage                      # é¦–é¡µï¼ˆé¡¹ç›®åˆ—è¡¨ï¼‰
â”‚   â”œâ”€â”€ WorkspaceShell                # æ‰‹åŠ¨æ¨¡å¼ä¸»ç•Œé¢
â”‚   â”œâ”€â”€ StoryGenerationPanel          # æ•…äº‹ç”Ÿæˆé¢æ¿
â”‚   â”œâ”€â”€ ScriptGenerationPanel         # å‰§æœ¬ç”Ÿæˆé¢æ¿
â”‚   â”œâ”€â”€ StoryboardGenerationPanel     # åˆ†é•œç”Ÿæˆé¢æ¿
â”‚   â”œâ”€â”€ CharacterGenerationPanel      # è§’è‰²ç”Ÿæˆé¢æ¿
â”‚   â”œâ”€â”€ SceneGenerationPanel          # åœºæ™¯ç”Ÿæˆé¢æ¿
â”‚   â”œâ”€â”€ PropGenerationPanel           # ç‰©å“ç”Ÿæˆé¢æ¿
â”‚   â”œâ”€â”€ DrawingSpaceWidget            # ç»˜å›¾ç©ºé—´
â”‚   â”œâ”€â”€ VideoSpaceWidget              # è§†é¢‘ç©ºé—´
â”‚   â”œâ”€â”€ MaterialsLibraryWidget        # ç´ æåº“
â”‚   â”œâ”€â”€ SystemLogsWidget              # ç³»ç»Ÿæ—¥å¿—
â”‚   â”œâ”€â”€ WorkspaceState                # å·¥ä½œåŒºçŠ¶æ€
â”‚   â”œâ”€â”€ GeneratedMediaManager         # ç”Ÿæˆå†…å®¹ç®¡ç†å™¨
â”‚   â””â”€â”€ LogService                    # æ—¥å¿—æœåŠ¡
â”‚
â”œâ”€â”€ logic/
â”‚   â””â”€â”€ auto_mode_provider.dart       # è‡ªåŠ¨æ¨¡å¼çŠ¶æ€ç®¡ç†
â”‚
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ auto_mode_project.dart        # è‡ªåŠ¨æ¨¡å¼é¡¹ç›®æ¨¡å‹
â”‚   â”œâ”€â”€ auto_mode_step.dart           # å·¥ä½œæµæ­¥éª¤
â”‚   â”œâ”€â”€ scene_model.dart              # åœºæ™¯æ¨¡å‹
â”‚   â”œâ”€â”€ scene_status.dart             # åœºæ™¯çŠ¶æ€
â”‚   â”œâ”€â”€ character_model.dart          # è§’è‰²æ¨¡å‹
â”‚   â””â”€â”€ prompt_template.dart          # æç¤ºè¯æ¨¡æ¿
â”‚
â”œâ”€â”€ views/
â”‚   â”œâ”€â”€ auto_mode_screen.dart         # è‡ªåŠ¨æ¨¡å¼ UI
â”‚   â””â”€â”€ prompt_config_view.dart       # æç¤ºè¯é…ç½® UI
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ api_manager.dart              # API ç®¡ç†å™¨ï¼ˆæ··åˆä¾›åº”å•†ï¼‰
â”‚   â”œâ”€â”€ api_config_manager.dart       # API é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ api_service.dart              # API è°ƒç”¨æœåŠ¡
â”‚   â”œâ”€â”€ ffmpeg_service.dart           # FFmpeg è§†é¢‘å¤„ç†
â”‚   â”œâ”€â”€ heavy_task_runner.dart        # å¹¶å‘ä»»åŠ¡ç®¡ç†
â”‚   â”œâ”€â”€ generation_queue.dart         # ç”Ÿæˆé˜Ÿåˆ—
â”‚   â”œâ”€â”€ prompt_store.dart             # æç¤ºè¯æ¨¡æ¿å­˜å‚¨
â”‚   â”œâ”€â”€ update_service.dart           # è‡ªåŠ¨æ›´æ–°
â”‚   â”œâ”€â”€ providers/
â”‚   â”‚   â”œâ”€â”€ base_provider.dart        # API ä¾›åº”å•†åŸºç±»
â”‚   â”‚   â””â”€â”€ geeknow_provider.dart     # Geeknow å®ç°
â”‚   â””â”€â”€ index.dart                    # æœåŠ¡å¯¼å‡º
â”‚
â”œâ”€â”€ widgets/
â”‚   â”œâ”€â”€ provider_selector.dart        # ä¾›åº”å•†é€‰æ‹©å™¨
â”‚   â””â”€â”€ README_PROVIDER_SELECTOR.md
â”‚
â””â”€â”€ save_settings_panel.dart          # ä¿å­˜è®¾ç½®é¢æ¿
```

### 10.2 main.dart ç»“æ„ï¼ˆ19000+ è¡Œï¼‰

```dart
// 1. å¯¼å…¥ï¼ˆ1-25 è¡Œï¼‰
import 'package:flutter/material.dart';
// ...

// 2. åº”ç”¨å…¥å£ï¼ˆ26-90 è¡Œï¼‰
void main() async { ... }

// 3. å…¨å±€å•ä¾‹å’Œç®¡ç†å™¨ï¼ˆ91-450 è¡Œï¼‰
final apiConfigManager = ApiConfigManager();
class LogService { ... }
class GeneratedMediaManager { ... }
class WorkspaceState { ... }
class ThemeManager { ... }

// 4. åº”ç”¨æ ¹ Widgetï¼ˆ1580-1750 è¡Œï¼‰
class AnimeApp extends StatefulWidget { ... }

// 5. å“åº”å¼å¸ƒå±€ç»„ä»¶ï¼ˆ1660-1750 è¡Œï¼‰
enum ScreenType { ... }
class ResponsiveLayoutWrapper { ... }
class ResponsiveInputWrapper { ... }

// 6. é¦–é¡µï¼ˆé¡¹ç›®åˆ—è¡¨ï¼‰ï¼ˆ1756-3250 è¡Œï¼‰
class HomePage extends StatefulWidget { ... }

// 7. è‡ªåŠ¨æ¨¡å¼é¡¹ç›®å…¥å£ï¼ˆ3250-3650 è¡Œï¼‰
// ï¼ˆå®é™… UI åœ¨ lib/views/auto_mode_screen.dartï¼‰

// 8. æ‰‹åŠ¨æ¨¡å¼ä¸»ç•Œé¢ï¼ˆ3650-4450 è¡Œï¼‰
class WorkspaceShell extends StatefulWidget { ... }

// 9. æ‰‹åŠ¨æ¨¡å¼å…­å¤§é¢æ¿ï¼ˆ4450-10180 è¡Œï¼‰
class StoryGenerationPanel extends StatefulWidget { ... }
class ScriptGenerationPanel extends StatefulWidget { ... }
class StoryboardGenerationPanel extends StatefulWidget { ... }
class CharacterGenerationPanel extends StatefulWidget { ... }
class SceneGenerationPanel extends StatefulWidget { ... }
class PropGenerationPanel extends StatefulWidget { ... }

// 10. åˆ†é•œåˆ—è¡¨ç®¡ç†ï¼ˆ10180-11260 è¡Œï¼‰

// 11. æç¤ºè¯é…ç½®è§†å›¾ï¼ˆ11260-12110 è¡Œï¼‰

// 12. ç»˜å›¾ç©ºé—´ï¼ˆ12110-13010 è¡Œï¼‰
class DrawingSpaceWidget extends StatefulWidget { ... }

// 13. è§†é¢‘ç©ºé—´ï¼ˆ13010-14570 è¡Œï¼‰
class VideoSpaceWidget extends StatefulWidget { ... }

// 14. ç´ æåº“ï¼ˆ14570-15770 è¡Œï¼‰
class MaterialsLibraryWidget extends StatefulWidget { ... }

// 15. ç³»ç»Ÿæ—¥å¿—ï¼ˆ15770-16840 è¡Œï¼‰
class SystemLogsWidget extends StatefulWidget { ... }

// 16. è®¾ç½®é¢æ¿ï¼ˆ16840-18870 è¡Œï¼‰

// 17. å·¥å…·å‡½æ•°å’Œè¾…åŠ©ç±»ï¼ˆ18870-19188 è¡Œï¼‰
```

---

## 11. ä¿®æ”¹æŒ‡å—

### 11.1 å¦‚ä½•æ·»åŠ æ–°çš„åŠŸèƒ½é¢æ¿

**æ­¥éª¤ 1ï¼šåˆ›å»ºé¢æ¿ Widget**

```dart
// åœ¨ lib/main.dart ä¸­æ·»åŠ 

class MyNewPanel extends StatefulWidget {
  @override
  _MyNewPanelState createState() => _MyNewPanelState();
}

class _MyNewPanelState extends State<MyNewPanel> {
  @override
  Widget build(BuildContext context) {
    return Container(
      child: Text('æˆ‘çš„æ–°é¢æ¿'),
    );
  }
}
```

**æ­¥éª¤ 2ï¼šæ·»åŠ åˆ° WorkspaceShell çš„é¢æ¿åˆ—è¡¨**

```dart
class _WorkspaceShellState extends State<WorkspaceShell> {
  final List<Widget> _pages = [
    StoryGenerationPanel(),
    ScriptGenerationPanel(),
    StoryboardGenerationPanel(),
    CharacterGenerationPanel(),
    SceneGenerationPanel(),
    PropGenerationPanel(),
    MyNewPanel(),  // æ–°å¢
  ];
  
  final List<(IconData, String)> _navItems = [
    (Icons.book_outlined, 'æ•…äº‹ç”Ÿæˆ'),
    (Icons.description_outlined, 'å‰§æœ¬ç”Ÿæˆ'),
    (Icons.view_carousel_outlined, 'åˆ†é•œç”Ÿæˆ'),
    (Icons.person_outlined, 'è§’è‰²ç”Ÿæˆ'),
    (Icons.landscape_outlined, 'åœºæ™¯ç”Ÿæˆ'),
    (Icons.category_outlined, 'ç‰©å“ç”Ÿæˆ'),
    (Icons.star_outlined, 'æˆ‘çš„æ–°åŠŸèƒ½'),  // æ–°å¢
  ];
}
```

### 11.2 å¦‚ä½•æ·»åŠ æ–°çš„ SharedPreferences é”®

```dart
// 1. å®šä¹‰é”®åå¸¸é‡
class PrefsKeys {
  static const String myNewKey = 'my_new_key';
}

// 2. åœ¨é¢æ¿ä¸­ä½¿ç”¨
Future<void> _saveData() async {
  final prefs = await SharedPreferences.getInstance();
  await prefs.setString(PrefsKeys.myNewKey, _myData);
}

Future<void> _loadData() async {
  final prefs = await SharedPreferences.getInstance();
  _myData = prefs.getString(PrefsKeys.myNewKey) ?? '';
  setState(() {});
}
```

### 11.3 å¦‚ä½•ä¿®æ”¹ API è°ƒç”¨

```dart
// ç¤ºä¾‹ï¼šä¿®æ”¹æ•…äº‹ç”Ÿæˆçš„ API è°ƒç”¨

Future<void> _generateStory() async {
  setState(() => _isLoading = true);
  
  try {
    // 1. æ„å»ºæç¤ºè¯
    final prompt = '''
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ•…äº‹ä½œå®¶ã€‚è¯·æ ¹æ®ä»¥ä¸‹åˆ›æ„ç”Ÿæˆä¸€ä¸ªå®Œæ•´æ•…äº‹ã€‚

åˆ›æ„ï¼š${_inputController.text}

è¦æ±‚ï¼š
1. æ•…äº‹è¦æœ‰å¼€å¤´ã€å‘å±•ã€é«˜æ½®ã€ç»“å°¾
2. è§’è‰²æ€§æ ¼é²œæ˜
3. æƒ…èŠ‚è·Œå®•èµ·ä¼
''';
    
    // 2. è°ƒç”¨ API
    final result = await ApiManager().chatCompletion(
      model: apiConfigManager.llmModel,
      messages: [
        {'role': 'system', 'content': 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ•…äº‹ä½œå®¶'},
        {'role': 'user', 'content': prompt},
      ],
      temperature: 0.8,  // å¢åŠ åˆ›é€ æ€§
      maxTokens: 2048,
    );
    
    // 3. æ›´æ–° UI
    setState(() {
      _generatedStory = result;
      _isLoading = false;
    });
    
    // 4. ä¿å­˜æ•°æ®
    await _saveData();
    
    // 5. æ˜¾ç¤ºæˆåŠŸæç¤º
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text('æ•…äº‹ç”ŸæˆæˆåŠŸï¼')),
    );
  } catch (e) {
    // é”™è¯¯å¤„ç†
    setState(() => _isLoading = false);
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text('ç”Ÿæˆå¤±è´¥: $e')),
    );
  }
}
```

### 11.4 å¦‚ä½•æ·»åŠ æ–°çš„ API ä¾›åº”å•†

å‚è€ƒ `COMPREHENSIVE_GUIDE.md` ç¬¬ 4.5 èŠ‚"æ‰©å±•æ–°ä¾›åº”å•†"ã€‚

### 11.5 å¸¸è§ä¿®æ”¹ä»»åŠ¡

#### ä»»åŠ¡ 1ï¼šä¿®æ”¹é¢æ¿å¸ƒå±€

```dart
// æ‰¾åˆ°å¯¹åº”çš„é¢æ¿ Widgetï¼ˆå¦‚ StoryGenerationPanelï¼‰
// ä¿®æ”¹ build() æ–¹æ³•ä¸­çš„å¸ƒå±€ä»£ç 

Widget build(BuildContext context) {
  return Padding(
    padding: EdgeInsets.all(28),
    child: Column(
      children: [
        // ä¿®æ”¹è¿™é‡Œçš„å¸ƒå±€ç»“æ„
        _buildHeader(),
        SizedBox(height: 28),
        Expanded(
          child: Row(
            children: [
              Expanded(child: _buildInputArea()),
              SizedBox(width: 20),
              Expanded(child: _buildResultArea()),
            ],
          ),
        ),
      ],
    ),
  );
}
```

#### ä»»åŠ¡ 2ï¼šæ·»åŠ æ–°çš„æç¤ºè¯æ¨¡æ¿

```dart
// åœ¨ lib/services/prompt_store.dart ä¸­æ·»åŠ 

Future<void> initialize() async {
  _templates.addAll([
    // ... ç°æœ‰æ¨¡æ¿
    PromptTemplate(
      id: 'my_new_template',
      category: 'story',
      name: 'æˆ‘çš„æ–°æ¨¡æ¿',
      content: '''
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ä½œå®¶ã€‚è¯·æ ¹æ®ä»¥ä¸‹è¦æ±‚ç”Ÿæˆå†…å®¹ï¼š

ç”¨æˆ·è¾“å…¥ï¼š{{input}}

è¦æ±‚ï¼š
1. ...
2. ...
''',
    ),
  ]);
}
```

#### ä»»åŠ¡ 3ï¼šä¿®æ”¹ç”Ÿæˆç»“æœæ˜¾ç¤ºæ ¼å¼

```dart
// åœ¨é¢æ¿çš„ _buildResultArea() æ–¹æ³•ä¸­ä¿®æ”¹

Widget _buildResultArea() {
  if (_generatedResult == null) {
    return Center(child: Text('æš‚æ— ç”Ÿæˆç»“æœ'));
  }
  
  return Column(
    children: [
      // æ·»åŠ æ ‡é¢˜
      Text(
        'ç”Ÿæˆç»“æœ',
        style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
      ),
      SizedBox(height: 16),
      
      // æ˜¾ç¤ºç»“æœ
      Expanded(
        child: SingleChildScrollView(
          child: SelectableText(
            _generatedResult!,
            style: TextStyle(fontSize: 15, height: 1.5),
          ),
        ),
      ),
      
      // æ“ä½œæŒ‰é’®
      Row(
        mainAxisAlignment: MainAxisAlignment.end,
        children: [
          TextButton.icon(
            onPressed: _copyToClipboard,
            icon: Icon(Icons.copy),
            label: Text('å¤åˆ¶'),
          ),
          TextButton.icon(
            onPressed: _saveResult,
            icon: Icon(Icons.save),
            label: Text('ä¿å­˜'),
          ),
        ],
      ),
    ],
  );
}
```

---

## 12. æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **åŒæ¨¡å¼æ¶æ„**ï¼šè‡ªåŠ¨æ¨¡å¼ï¼ˆå…¨è‡ªåŠ¨ï¼‰+ æ‰‹åŠ¨æ¨¡å¼ï¼ˆæ¨¡å—åŒ–ï¼‰
2. **æ‰‹åŠ¨æ¨¡å¼ç‰¹ç‚¹**ï¼š
   - æ— é¡¹ç›®æ¦‚å¿µï¼Œå•ä¸€å·¥ä½œåŒº
   - 6 ä¸ªç‹¬ç«‹é¢æ¿ï¼Œå„è‡ªç®¡ç†çŠ¶æ€
   - æ•°æ®å­˜å‚¨åœ¨ SharedPreferences
   - é¢æ¿é—´é€šè¿‡å¤åˆ¶ç²˜è´´æˆ– SharedPreferences å…³è”
3. **æ•°æ®æµ**ï¼šUI â†’ ApiManager â†’ ä¾›åº”å•† â†’ SharedPreferences
4. **çŠ¶æ€ç®¡ç†**ï¼šé¢æ¿å†…ç”¨ `setState`ï¼Œè·¨é¢æ¿ç”¨ `ChangeNotifier`

### é€‚ç”¨åœºæ™¯

æœ¬æ–‡æ¡£é€‚ç”¨äºï¼š
- âœ… å‘ AI å¤§è¯­è¨€æ¨¡å‹ä»‹ç»é¡¹ç›®ç»“æ„
- âœ… æ–°å¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹
- âœ… ç†è§£æ‰‹åŠ¨æ¨¡å¼çš„è¿ä½œæ–¹å¼
- âœ… ä¿®æ”¹å’Œæ‰©å±•åŠŸèƒ½
- âœ… æ•…éšœæ’æŸ¥å’Œä¼˜åŒ–

---

**æ–‡æ¡£ç»“æŸ**

å¦‚éœ€æ›´å¤šç»†èŠ‚ï¼Œè¯·å‚è€ƒï¼š
- `ARCHITECTURE.md` - è‡ªåŠ¨æ¨¡å¼è¯¦è§£
- `COMPREHENSIVE_GUIDE.md` - API æ¶æ„è¯¦è§£
- `AUTO_UPDATE_GUIDE.md` - è‡ªåŠ¨æ›´æ–°æœºåˆ¶
- `SUPABASE_SETUP.md` - Supabase é…ç½®
